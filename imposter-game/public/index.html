<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Imposter Game</title>
<script src="/socket.io/socket.io.js"></script>
<style>
  body { font-family: sans-serif; background: #222; color: #eee; padding: 20px; }
  input, button { font-size: 1rem; margin: 5px 0; padding: 8px; }
  #game, #roleView { display: none; }
</style>
</head>
<body>

<h1>Imposter Game</h1>

<div id="startScreen">
  <button id="createBtn">Lobby erstellen</button>
  <hr>
  <input type="text" id="joinLobbyId" placeholder="Lobby-ID eingeben" maxlength="4" style="text-transform: uppercase" />
  <input type="text" id="playerName" placeholder="Dein Name" />
  <button id="joinBtn">Lobby beitreten</button>
  <p id="error" style="color: #f55;"></p>
</div>

<div id="lobby" >
  <h2>Lobby <span id="lobbyId"></span></h2>
  <h3>Spieler:</h3>
  <ul id="playersList"></ul>

  <div id="hostSettings" style="display:none">
    <input type="text" id="word" placeholder="Wort eingeben" />
    <input type="number" id="imposters" min="1" value="1" />
    <button id="saveSettings">Einstellungen speichern</button>
    <button id="startGame">Spiel starten</button>
  </div>
</div>

<div id="roleView">
  <h2>Deine Rolle</h2>
  <p id="roleText"></p>
</div>

<script>
  const socket = io();
  let currentLobby = null;
  let isHost = false;

  const startScreen = document.getElementById('startScreen');
  const lobbyDiv = document.getElementById('lobby');
  const roleView = document.getElementById('roleView');
  const playersList = document.getElementById('playersList');
  const lobbyIdSpan = document.getElementById('lobbyId');
  const errorP = document.getElementById('error');
  const hostSettings = document.getElementById('hostSettings');

  document.getElementById('createBtn').onclick = () => {
    socket.emit('createLobby');
  };

  socket.on('lobbyCreated', id => {
    currentLobby = id;
    isHost = true;
    lobbyIdSpan.textContent = id;
    startScreen.style.display = 'none';
    lobbyDiv.style.display = 'block';
    hostSettings.style.display = 'block';
    addPlayer(prompt("Dein Name?") || "Host");
  });

  function addPlayer(name) {
    socket.emit('joinLobby', { lobbyId: currentLobby, name });
  }

  document.getElementById('joinBtn').onclick = () => {
    const id = document.getElementById('joinLobbyId').value.trim().toUpperCase();
    const name = document.getElementById('playerName').value.trim();
    if (!id || !name) {
      errorP.textContent = "Bitte Lobby-ID und Namen eingeben";
      return;
    }
    currentLobby = id;
    addPlayer(name);
  };

  socket.on('errorMsg', msg => {
    errorP.textContent = msg;
  });

  socket.on('playerList', players => {
    playersList.innerHTML = '';
    players.forEach(p => {
      const li = document.createElement('li');
      li.textContent = p;
      playersList.appendChild(li);
    });
  });

  document.getElementById('saveSettings').onclick = () => {
    const word = document.getElementById('word').value.trim();
    const imposters = parseInt(document.getElementById('imposters').value);
    if (!word || !imposters || imposters < 1) {
      alert("Bitte gÃ¼ltiges Wort und Anzahl Imposter eingeben");
      return;
    }
    socket.emit('saveSettings', { lobbyId: currentLobby, word, imposters });
    alert("Einstellungen gespeichert");
  };

  document.getElementById('startGame').onclick = () => {
    socket.emit('startGame', currentLobby);
  };

  socket.on('settingsSaved', ({ word, imposters }) => {
    console.log(`Wort: ${word}, Imposter: ${imposters}`);
  });

  socket.on('gameStarted', () => {
    startScreen.style.display = 'none';
    lobbyDiv.style.display = 'none';
    roleView.style.display = 'block';
  });

  socket.on('roleAssigned', ({ role, word }) => {
    const roleText = role === 'imposter'
      ? 'Du bist der Imposter ðŸ¤«'
      : `Dein Wort ist: ${word}`;
    document.getElementById('roleText').textContent = roleText;
  });
</script>

</body>
</html>
